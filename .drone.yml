kind: pipeline
type: kubernetes
name: terraform-plan

steps:
  - name: print-secrets
    image: alpine
    environment:
      AWS_ACCESS_KEY_ID:
        from_secret: aws_access_key_id
      AWS_SECRET_ACCESS_KEY:
        from_secret: aws_secret_access_key
    commands:
      - echo "AWS Access Key: ${WS_ACCESS_KEY_ID}"
      - echo "AWS Secret Key: ${AWS_SECRET_ACCESS_KEY}"

  - name: terraform-plan
    image: hashicorp/terraform
    commands:
      - terraform init
      - terraform plan
    environment:
      AWS_ACCESS_KEY_ID:
        from_secret: aws_access_key_id
      AWS_SECRET_ACCESS_KEY:
        from_secret: aws_secret_access_key
